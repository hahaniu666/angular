<div flex="" layout="column" class="ks-orderDetail ks-main md-whiteframe-z2 ">
    <md-toolbar class="md-menu-toolbar ks-header topToolbar">
        <div flex layout="row" class="ks-header-divWrap ks-user-divWrap">
            <div class="divTop" flex>
                <md-icon md-font-set="ks-icon" class="chevron_left" ng-click="fallbackPage()"
                         md-font-icon="ks-arrow_left"></md-icon>
                <span class="regSpan">订单详情</span>
            </div>
        </div>
            <span class="cancleBtn"
                  ng-click="orderCancel($event)"
                  ng-if="order.status==='UNPAYED'">取消订单</span>
    </md-toolbar>
    <md-divider></md-divider>
    <md-content flex>
        <div class="extract_ser" ng-if="order.type==='SERVICE'">
            <div class="condition">
                <md-icon md-font-set="ks-icon" md-font-icon="ks-location-o"></md-icon>
                <span>寄送地址</span>
            </div>
            <div class="addr">
                {{addr.value}}<br>{{phone.value}}
            </div>
        </div>
        <div class="extract" flex layout="row" ng-if="order.type==='CLEANORDER'"
             ui-sref="main.vip.baiduMap({cleanOrder:'true'})">
            <div class="condition" flex>
                <md-icon md-font-set="ks-icon" md-font-icon="ks-heart" ng-if="order.status==='PAYED'"></md-icon>
                <md-icon md-font-set="ks-icon" md-font-icon="ks-card" ng-if="order.status==='UNPAYED'"></md-icon>
                <md-icon md-font-set="ks-icon" md-font-icon="ks-card" ng-if="order.status==='CLOSED'"></md-icon>
                <md-icon md-font-set="ks-icon" md-font-icon="ks-done" ng-if="order.status==='FINISHED'"></md-icon>
                <md-icon md-font-set="ks-icon" md-font-icon="ks-time" ng-if="order.status==='SERVICEING'"></md-icon>
                <md-icon md-font-set="ks-icon" md-font-icon="ks-timing" ng-if="order.status==='REFUND'"></md-icon>
                <span ng-if="order.status==='PAYED'">待服务</span>
                <span ng-if="order.status==='UNPAYED'">待付款</span>
                <span ng-if="order.status==='CLOSED'">已关闭</span>
                <span ng-if="order.status==='FINISHED'">已完成</span>
                <span ng-if="order.status==='SERVICEING'">服务中</span>
                <span ng-if="order.status==='REFUND'">退款中</span>
            </div>
            <div class="findShop" flex ng-click="vm.searchShops()">
                <span>|</span>
                查看附近门店
                <md-icon class="ks-icon" md-font-set="ks-icon" md-font-icon="ks-arrow_right"></md-icon>
            </div>
        </div>
        <!--此处有修改  下面还有一处-->
        <div class="orderMessage" ng-if="!classActive.view">
            <div class="orderMessageTop">
                <div class="leftBlock"></div>
                <span>订单信息</span>
            </div>
            <div class="orderMessageWrap">
                <div class="wrapChild">
                    <div class="txtMessage">订单编号：</div>
                    <span>{{order.seq}}</span>
                </div>
                <div class="wrapChild">
                    <div class="txtMessage">下单时间：</div>
                    <span>{{order.dateCreated|date:"yyyy-MM-dd HH:mm"}}</span>
                </div>
                <div class="wrapChild" ng-if="order.type!=='CLEANORDER'">
                    <div class="txtMessage">订单状态：</div>
                    <span>{{order.statusName}}</span>
                </div>
            </div>
        </div>

        <div class="orderDetailHeader" ng-if="classActive.view">
            <div class="orderDetailHeaderTop">
                <md-icon class="ks-icon" md-font-set="ks-icon" ng-if="order.status==='UNPAYED'">card</md-icon>
                <md-icon class="ks-icon" md-font-set="ks-icon" ng-if="order.status==='UNRECEIVED'">delivery</md-icon>
                <md-icon class="ks-icon" md-font-set="ks-icon"
                         ng-if="order.status==='SERVICEING'"
                         md-font-icon="ks-heart"></md-icon>
                <md-icon class="ks-icon" md-font-set="ks-icon" ng-if="order.status==='UNCOMMENTED'">edit</md-icon>
                <md-icon class="ks-icon" md-font-set="ks-icon"
                         ng-if="order.type==='SERVICE' && order.status==='UNSHIPPED'"
                         md-font-icon="ks-drawer-arrow-up"></md-icon>
                <md-icon class="ks-icon" md-font-set="ks-icon" ng-if="order.type==='ITEM' && order.status==='UNSHIPPED'"
                         md-font-icon="ks-drawer-arrow-up"></md-icon>
                <!--    <md-icon class="ks-icon" md-font-set="ks-icon"
                             ng-if="order.status==='UNCONFIRMED'||order.status === 'CANCELING'">
                        timing
                    </md-icon>-->
                <md-icon class="ks-icon" md-font-set="ks-icon"
                         ng-if="order.status==='UNCONFIRMED'||order.status === 'CANCELING'"
                         md-font-icon="ks-timing"></md-icon>
                <md-icon class="ks-icon" md-font-set="ks-icon"
                         ng-if="order.status==='USER_UNSHIPPED'|| order.status==='USER_SHIPPED'"
                         md-font-icon="ks-heart"></md-icon>
                <!--   <md-icon class="ks-icon" md-font-set="ks-icon" md-font-icon="ks-drawer-arrow-up"
                            ng-if="order.status==='UNSHIPPED'"
                   ></md-icon>-->
                <md-icon class="ks-icon" md-font-set="ks-icon" ng-if="order.status==='FINISHED'">done</md-icon>

                <div ng-if="order.status==='UNCONFIRMED'">待确认</div>
                <div ng-if="order.type==='SERVICE' && (order.status==='UNSHIPPED')">待发货
                </div>
                <div ng-if="order.status==='USER_UNSHIPPED'|| order.status==='USER_SHIPPED'">待服务</div>
                <div ng-if="order.type==='ITEM' && order.status==='UNSHIPPED'">待发货</div>
                <!--<div ng-if="order.status==='USER_UNSHIPPED'">待买家寄出</div>-->
                <div ng-if="order.status!=='UNCONFIRMED'
                    && order.status!=='UNSHIPPED'
                    && order.status!=='USER_UNSHIPPED'
                    && order.status!=='USER_SHIPPED'">
                    {{order.statusName}}
                </div>
            </div>
            <div class="orderDetailHeaderBottom" ng-if="order.type==='ITEM'">
                <div class="bottomList">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[0]
                    && order.status!=='SERVICEING'}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[0]}">提交订单</div>
                </div>
                <div class="bottomList">
                    <div class="circle ">
                        <div class="circleIn" ng-class="{active:classActive.css[1]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[1]}">已支付</div>
                </div>
                <div class="bottomList">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[2]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[2]}">已确认</div>
                </div>
                <div class="bottomList">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[3]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[3]}">已收货</div>
                </div>
                <div class="bottomList">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[4]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[4]}">已评价</div>
                </div>
                <br style="clear: both">
                <div class="line"></div>
            </div>
            <!--服务订单有6个状态，单独放置-->
            <div class="orderDetailHeaderBottom" ng-if="order.type==='SERVICE'">
                <div class="bottomList_ser">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[0]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[0]}">提交订单</div>
                </div>
                <div class="bottomList_ser">
                    <div class="circle ">
                        <div class="circleIn" ng-class="{active:classActive.css[1]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[1]}">已支付</div>
                </div>
                <div class="bottomList_ser">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[2]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[2]}">已确认</div>
                </div>
                <div class="bottomList_ser">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[3]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[3]}">已服务</div>
                </div>
                <div class="bottomList_ser">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[4]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[4]}">已收货</div>
                </div>
                <div class="bottomList_ser">
                    <div class="circle">
                        <div class="circleIn" ng-class="{active:classActive.css[5]}"></div>
                    </div>
                    <div class="word" ng-class="{cur:classActive.css[5]}">已评价</div>
                </div>
                <br style="clear: both">
                <div class="line"></div>
            </div>
        </div>
        <div class="partLine"></div>
        <div class="orderMessage" ng-if="classActive.view">
            <div class="orderMessageTop">
                <div class="leftBlock"></div>
                <span>订单信息</span>
            </div>
            <div class="orderMessageWrap">
                <div class="wrapChild">
                    <div class="txtMessage">订单编号：</div>
                    <span>{{order.seq}}</span>
                </div>
                <div class="wrapChild">
                    <div class="txtMessage">下单时间：</div>
                    <span>{{order.dateCreated|date:"yyyy-MM-dd HH:mm"}}</span>
                </div>

            </div>
            <md-divider></md-divider>
        </div>

        <div class="distribution" ng-if="order.type!=='CLEANORDER'">
            <div class="distributionHeader">
                <div class="leftBlock"></div>
                <span>配送</span>
            </div>
            <div class="txtWrap" layout="row">
                <div class="txt" style="font-size: 14px; text-indent: 18px;  width: 85px;">订单跟踪:</div>
                <div class="txt" flex style="margin-left: 5px" layout="row" ng-click="queryLogistics()">
                    {{logistics.trackInfo[0].content}}<br>
                    {{logistics.trackInfo[0].time|date:'yyyy-MM-dd HH:MM:ss'}}
                </div>
                <div class="txt" flex="8" layout="row" layout-align="end">
                    <md-icon class="chevron_left ks-icon" md-font-set="ks-icon">arrow_right</md-icon>
                </div>
            </div>
            <div class="distributionMode">
                <div class="txt" style="font-size: 14px; text-indent: 18px;  width: 85px;">配送方式:</div>
                <span>快递 包邮</span>
            </div>
            <div class="address" layout="column">
                <div class="addressTxt">{{order.address.contact}} {{order.address.phone}}</div>
                <div class="addressTxt" flex layout="row">
                    {{order.address.province}}/{{order.address.city}}/
                    {{order.address.area}}/{{order.address.street}}
                </div>
            </div>
        </div>
        <div class="commodityList">
            <div class="commodityListHeader">
                <div class="leftBlock"></div>
                <span>商品清单</span>
            </div>
        </div>
        <div class="commodityListContent" ng-repeat="orderItem in order.orderItems">
            <md-divider class="dashed"></md-divider>
            <img class="contentListImg"
                 ng-src="{{imgUrl}}{{orderItem.img}}?imageView2/2/w/{{simpleImg.w}}/h/{{simpleImg.h}}"
                 ng-if="!orderItem.selectImg">
            <img class="contentListImg"
                 ng-src="{{imgUrl}}{{orderItem.selectImg}}?imageView2/2/w/{{simpleImg.w}}/h/{{simpleImg.h}}"
                 ng-if="orderItem.selectImg" style="background-color: #333">
            <div class="contentListRight" ng-click="itemDetail(orderItem)">
                <div class="right1" ng-if="orderItem.num">{{orderItem.title}}</div>
                <div class="right1" ng-if="!orderItem.num">服务物品:{{orderItem.title}}</div>
                <!--<span class="spanWrap" layout="row" flex>
                    <span class="text-spec" ng-repeat="spec in orderItem.specs">
                                        {{spec.name}}：{{spec.value}}；
                                    </span>
                </span>-->
                <div class="item-specs">
                    <span ng-repeat="spec in orderItem.specs">
                        <span ng-if="$index != orderItem.specs.length-1">{{spec.name}}:{{spec.value}}；</span>
                        <span ng-if="$index == orderItem.specs.length-1">{{spec.name}}:{{spec.value}}</span>
                    </span>
                </div>
                <div class="num1" ng-if="orderItem.price">￥{{orderItem.price/100.0|num:1}}</div>
                <div class="num2" ng-if="orderItem.num">x{{orderItem.num}}</div>
                <br style="clear: both">
            </div>
            <div class="ib" layout="row"
                 ng-if="order.status=='UNRECEIVED'||order.status=='UNCOMMENTED'||order.status=='FINISHED'||
                            order.status=='USER_UNSHIPPED' || order.status=='UNSHIPPED' || order.status=='USER_SHIPPED'">
                <span flex layout="column" layout-align="center end"></span>
                <!--        <span ng-if="orderItem.refund">
                            <md-button style="border: 1px solid #101010" class="ks-white"
                                       ng-if="orderItem.refund.status!='WAIT_BUYER_SENDING'">-->
                    <span class="ibButton" ng-if="orderItem.refund" layout="row">
                        <i flex></i>
                        <md-button class="ks-white ibBtn"
                                   ng-class="{refundOnlyText:orderItem.refund.status!='FINISHED',refundOnlyFinish:orderItem.refund.status==='FINISHED'}"
                                   ng-if="orderItem.refund.status!=('WAIT_BUYER_SENDING')">
                            {{orderItem.refund.name}}
                        </md-button>
                         <md-button class="ks-white ibBtn"
                                    ng-if="orderItem.refund.status==='WAIT_BUYER_SENDING'"
                                    ng-click="inputLogistics(orderItem.refund)">
                             {{orderItem.refund.name}}
                         </md-button>
                    </span>
                <span class="ibButton" ng-if="!orderItem.refund && order.type=='ITEM'" layout="row">
                    <i flex></i>
                     <md-button class="ks-white ibBtn" ng-click="orderRefund(orderItem)">退款
                     </md-button>
                     <i flex="5"></i>
                </span>
                <span class="ibButton" ng-if="!orderItem.refund && order.type=='SERVICE'" layout="row">
                    <i flex></i>
                     <md-button class="ks-white ibBtn" ng-click="orderRefund(orderItem)">退款
                     </md-button>
                     <i flex="5"></i>
                </span>

            </div>
            <br style="clear: both">
        </div>
        <div class="discount">
            <md-divider></md-divider>
            <div class="discountHeader">
                <div class="leftBlock"></div>
                <span>优惠券</span>
                <p ng-if="!order.coupon"
                   style="font-size: 14px;color: #999;height: 0px; margin-right: 7px;float: right;display: inline">
                    未选择</p>
                <br style="clear: both">
            </div>
            <md-divider ng-if="!order.coupon" style="clear: both"></md-divider>
            <md-divider ng-if="order.coupon" class="dashed" style="clear: both;margin-left: 12px"></md-divider>
            <div class="discountbottom" ng-if="order.coupon">
                {{order.coupon.name}}
            </div>
        </div>
        <div class="invoice">
            <div class="invoiceHeader">
                <div class="leftBlock"></div>
                <span>发票信息</span>
                <p ng-if="!order.invoiceTitle"
                   style="font-size: 14px;height: 0px; color: #999; margin-right: 7px;float: right;display: inline">
                    未选择</p>
            </div>
            <md-divider ng-if="!order.invoiceTitle" style="clear: both"></md-divider>
            <md-divider ng-if="order.invoiceTitle" class="dashed" style="clear: both;margin-left: 12px"></md-divider>
            <div class="invoiceMode" ng-if="order.invoiceTitle">
                <div class="txt" style="font-size: 14px; text-indent: 30px;  width: 96px;">
                    发票抬头:
                </div>
                <span>{{order.invoiceTitle}}</span>
            </div>
        </div>
        <!--礼品卡-->
        <div class="invoice" ng-if="order.canUseGift">
            <div class="invoiceHeader">
                <div class="leftBlock"></div>
                <span>使用礼品卡抵用￥{{order.useGiftAmount/100|num:1}}</span>
                <!--<md-switch style="float: right;display: inline;margin: 10px 0 0 0 " class="ks-gold"></md-switch>-->
            </div>
            <md-divider style="clear: both;padding-top: -10px"></md-divider>
        </div>
        <div class="cash">
            <!--<div class="csahTxt">商品金额：￥{{(order.orderPrice)/100.0|num:2}}</div>
            <div class="csahTxt" ng-if="order.adjustedAmount">客服修改：￥{{order.adjustedAmount/100.0|num:2}}</div>
            <div class="csahTxt" ng-if="order.coupon">{{order.coupon.name}}：-￥{{order.coupon.reduceMoney/100.0|num:2}}
            </div>-->

            <!-- --------------------------------------此处有修改---------------------------------------------- -->
            <div class="csahTxt">商品金额：￥{{(order.orderPrice)/100.0|num:1}}</div>
            <div class="csahTxt" ng-if="order.coupon">优惠券：-￥{{order.coupon.reduceMoney/100.0|num:1}}</div>
            <div class="csahTxt" ng-if="order.orderItems&&minusPrice>0">
                指定满减活动- ￥{{minusPrice/100.0|num:1}}
            </div>
            <div class="csahTxt" ng-if="order.activitys.length>0">
                {{order.activitys[0].name}}- ￥{{order.activitys[0].price/100.0|num:1}}
            </div>
            <div class="csahTxt" ng-if="order.useGiftAmount > 0">
                使用礼品卡:- ￥{{order.useGiftAmount/100|num:1}}
            </div>
            <div class="csahTxt" ng-if="order.usedIntegral > 0">
                使用钱币:- {{(order.usedIntegral/100)|num:1}}
            </div>
            <div class="csahTxt" style="color: #101010" ng-if="order.status!='UNPAYED'">
                应付金额：￥{{(order.paymentAmount)/100.0|num:1}}
            </div>
        </div>
        <div class="textArea" ng-if="order.type!=='CLEANORDER'">
            <div class="message">{{order.buyerMemo}}</div>
            <!-- <textarea flex style="resize: none"
                       placeholder="买家备注"></textarea>-->
        </div>
        <!--<div style="background:#fff; flex-shrink: 0;min-height: 48px" ></div>-->
    </md-content>
    <md-divider ng-if="order.status!='CANCELING'&&order.status=='UNPAYED'"></md-divider>
    <div class="pay-amount" layout="column" layout-align="center center"
         ng-if="order.status=='UNPAYED'">
        应付金额：￥{{(order.paymentAmount)/100.0|num:1}}
    </div>
    <div class="submit-btn" layout="row" layout-align="center center"
         ng-if="order.status=='UNPAYED'">
        <md-button class="ks-black md-raised" flex="90" ng-click="orderPay()" ng-if="order.type!=='CLEANORDER'">
            去支付
            <!-- <span style="color: #ba9f6e;font-size: 14px !important;" class="countDown">
                 [23:59]
             </span>-->
        </md-button>
        <md-button class="ks-black md-raised" flex="90" ng-click="orderCleanPay()" ng-if="order.type==='CLEANORDER'">
            去支付
        </md-button>
    </div>
    <!--<div ng-if="order.status!='UNPAYED'">-->
    <div class="fotterFixed" layout="column" ng-if="(order.status==='PAYED'||order.status==='SERVICEING'||order.status==='REFUND'||order.status==='FINISHED')&&order.type==='CLEANORDER'">
        <div layout="row">
            <div style="padding-bottom: 1px" class="fotterFixedBottom" layout="column" flex
                 layout-align="center center"
                 ng-click="orderCancel(5)" ng-if="order.status==='PAYED'||order.status==='SERVICEING'||order.status==='FINISHED'">退款
            </div>
            <div style="padding-bottom: 1px" class="fotterFixedBottom" layout="column" flex
                 layout-align="center center" ng-if="order.status==='REFUND'">退款中
            </div>
            <div class="fotterFixedBottom" layout="column" flex layout-align="center center"
                 ng-click="machine()" style="background: #ba9f6e">消毒柜
            </div>
        </div>
    </div>
    <div class="fotterFixed" layout="column" ng-if="order.status!='UNPAYED'&&order.type!=='CLEANORDER'"
         ng-class="{'disclear':order.status==='CANCELING'}">

        <div ng-if="order.status=='CANCELED'" layout="row">
            <div class="fotterFixedBottom" layout="column" flex layout-align="center center"
                 ng-click="deleteOrder()">删除订单
            </div>
            <div class="fotterFixedBottom" layout="column" flex layout-align="center center"
                 ng-click="againOrder()" style="background: #ba9f6e">再次下单
            </div>
        </div>
        <div ng-if="order.status=='UNRECEIVED'" layout="row">
            <!--<span ng-if="order.logistics" ng-click="queryLogistics(order.id)">查看物流</span>-->
            <div class="fotterFixedBottom" layout-align="center center"
                 flex
                 style="background: #333;color: #fff;line-height: 48px;"
                 ng-click="queryLogistics()"
            >订单跟踪
            </div>
            <div class="fotterFixedBottom" layout-align="center center"
                 flex
                 style="background: #ba9f6e;line-height: 48px;"
                 ng-click="orderConfirm($event)"
            >{{classActive.confirm}}
            </div>
        </div>
        <!--order.status=='UNSHIPPED'-->
        <div ng-if="order.status=='UNSHIPPED'" layout="row" ng-click="queryLogistics()">
            <!--<span ng-if="order.logistics" ng-click="queryLogistics(order.id)">查看物流</span>-->
            <div class="fotterFixedBottom" layout-align="center center"
                 flex
                 style="background: #333;color: #fff;line-height: 48px;"
            >订单跟踪
            </div>
        </div>
        <div ng-if="order.status=='UNCONFIRMED'" layout="row">
            <div class="fotterFixedBottom" layout="row" layout-align="center center"
                 ng-click="orderCancel($event)">取消订单(退款)
            </div>
        </div>
        <!-- 商品待发货才能取消 -->
        <!--  <div ng-if="order.type=='ITEM' && order.status=='UNSHIPPED'" layout="row">
              <div class="fotterFixedBottom" layout="row" layout-align="center center"
                   ng-click="orderCancel($event)">取消订单(退款)
              </div>
          </div>-->
        <!-- <div ng-if="order.status=='CANCELING'" layout="row" style="background: #fff">
         </div>-->
        <div ng-if="order.status=='UNCOMMENTED'" layout="row">
            <div class="fotterFixedBottom" layout="column" flex layout-align="center center"
                 ng-click="orderComment()">评价晒单
            </div>
            <div class="fotterFixedBottom" layout="column" flex layout-align="center center"
                 ng-click="againOrder()" style="background: #ba9f6e">再次下单
            </div>
        </div>
        <div ng-if="order.status=='FINISHED'" layout="row">
            <div style="padding-bottom: 1px" class="fotterFixedBottom" layout="column" flex
                 layout-align="center center"
                 ng-click="commentDetail()">查看评价
            </div>
            <div class="fotterFixedBottom" layout="column" flex layout-align="center center"
                 ng-click="againOrder()" style="background: #ba9f6e">再次下单
            </div>
        </div>
        <div ng-if="order.status=='USER_UNSHIPPED' " layout="row">
            <div class="fotterFixedBottom" layout="row" layout-align="center center"
                 ng-click="hadtoMail(order.id)">填写物流
            </div>
        </div>
        <!--</div>-->
    </div>
</div>